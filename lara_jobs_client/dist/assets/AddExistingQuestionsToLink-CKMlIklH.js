import{r as o,i as A,j as t,h as P,b as m,c as p,V as i}from"./index-CVcFn3UJ.js";const x=10,R=()=>{const[d,b]=o.useState([]),[j,_]=o.useState(""),[u,v]=o.useState([]),[c,l]=o.useState([]),[g,$]=o.useState(1),[C,w]=o.useState(1),[h,N]=o.useState(),{test_id:a}=A(),y=async()=>{try{const e=await m.get(`${p}/api/placement-test/test/test-link/${a}`);N(e.data)}catch(e){console.error("Error fetching test :",e),e.response&&e.response.status===404?i.error("No Test details found"):i.error("Something went wrong")}};o.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No token provided.");const n={headers:{Authorization:`Bearer ${s}`}};console.log("test id ",a);const r=await m.post(`${p}/api/placement-test/topic/topics-assignedto-test`,{placement_test_id:a},{...n});r.data.topics?b(r.data.topics):i.error("No topics found for this placement test.")}catch(s){console.error("Error fetching topics:",s),i.error(s.message)}})(),y()},[a]);const k=async e=>{const s=e.target.value;_(s);try{const n=localStorage.getItem("token");if(!n)throw new Error("No token provided.");const r={headers:{Authorization:`Bearer ${n}`}},f=(await m.post(`${p}/api/placement-test/questions/getQuestionsByTopicId`,{topic_id:s},r)).data.questions;v(f),w(Math.ceil(f.length/x))}catch(n){n.response&&n.response.status===404?i.error("No Questions found for the selected Topic"):(console.error("Error fetching questions:",n),i.error(n.message))}},S=e=>{const s=c.includes(e);l(s?c.filter(n=>n!==e):[...c,e])},T=async()=>{try{const e=localStorage.getItem("token");if(!e)throw new Error("No token provided.");const s={headers:{Authorization:`Bearer ${e}`}},n={placement_test_id:a,question_ids:c},r=await m.post(`${p}/api/placement-test/test/test-link/assign-selected-questions`,{placement_test_id:a,question_ids:c});i.success("Assigned successsfully")}catch(e){console.error("Error adding questions:",e),i.error(e.message)}},q=()=>{l(u.map(e=>e.cumulative_question_id))},Q=()=>{const e=[...u];if(e.length>45){const s=e.sort(()=>.5-Math.random());l(s.slice(0,45).map(n=>n.cumulative_question_id))}else l(e.map(s=>s.cumulative_question_id))},E=u.slice((g-1)*x,g*x);return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"my-4",children:[t.jsx("div",{className:"container",children:h&&t.jsxs("div",{className:"mb-3 flex flex-wrap",children:[t.jsx("div",{className:"my-3 w-full md:w-5/12",children:t.jsxs("h5",{children:["Test Link:"," ",t.jsx("a",{href:h.data.test_link,target:"_blank",rel:"noopener noreferrer",children:h.data.test_link})]})}),t.jsx(P,{to:`/admin/test/add-new-question/${h.data.placement_test_id}`,className:"w-full md:w-5/12",children:t.jsx("span",{className:"btn btn-outline-primary",children:"Add New Questions for this test link"})})]})}),t.jsxs("div",{className:"flex flex-wrap mb-3",children:[t.jsx("div",{className:"w-full md:w-1/2 mb-3",children:t.jsxs("h5",{children:["Subject: ",d.length>0?d[0].subject_name:"N/A"]})}),t.jsxs("div",{className:"w-full md:w-1/2 mb-3 text-black",children:[t.jsx("label",{htmlFor:"topicSelect",className:"block mb-2 text-white",children:"Select Topic"}),t.jsxs("select",{id:"topicSelect",value:j,onChange:k,required:!0,disabled:d.length===0,className:"w-full border rounded-md p-2",children:[t.jsx("option",{value:"",children:"-- Select Topic --"}),d.map(e=>t.jsx("option",{value:e.topic_id,children:e.topic_name},e.topic_id))]})]})]}),t.jsxs("div",{className:"flex space-x-4 mb-3",children:[t.jsx("div",{children:t.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:q,children:"Select All"})}),t.jsx("div",{children:t.jsx("button",{className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",onClick:Q,children:"Select Random 45 Questions"})}),t.jsx("div",{children:t.jsx("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",onClick:T,disabled:c.length===0,children:"Add the selected Questions"})})]}),t.jsxs("div",{className:"w-full",children:[t.jsx("h4",{children:"Available Questions:"}),u.length===0?t.jsx("p",{children:"No questions available for the selected topic."}):t.jsxs(t.Fragment,{children:[t.jsx("ul",{children:E.map(e=>t.jsxs("li",{className:"my-2 border p-2",style:{listStyle:"none"},children:[t.jsx("input",{type:"checkbox",id:`question-${e.cumulative_question_id}`,className:"mr-2",checked:c.includes(e.cumulative_question_id),onChange:()=>S(e.cumulative_question_id)}),t.jsx("label",{htmlFor:`question-${e.cumulative_question_id}`,children:e.question_description})]},e.cumulative_question_id))}),t.jsx("div",{className:"flex justify-center my-4"})]})]})]})})};export{R as default};
