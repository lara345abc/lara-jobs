import{r as o,i as D,j as e,h as F,b as h,c as x,V as a}from"./index-CVcFn3UJ.js";const $="/assets/excel-sheet-example-CoA5l-qy.png",P=()=>{const[m,w]=o.useState([]),[c,N]=o.useState(""),[f,b]=o.useState(null),[v,g]=o.useState(!1),[k,S]=o.useState(""),{test_id:d}=D(),[p,_]=o.useState(null),[u,j]=o.useState(!1),[n,E]=o.useState(null);o.useEffect(()=>{const s=async()=>{try{const t=await h.get(`${x}/api/placement-test/test/test-link/${d}`);S(t.data.data.test_link),_(t.data.data)}catch(t){console.error("Error fetching test details : ",t),t.response&&t.response.status===404?a.error("No Test details found"):a.error("Something went wrong")}};(async()=>{try{const t=localStorage.getItem("token");if(!t)throw new Error("No token provided.");const r={headers:{Authorization:`Bearer ${t}`}},i=await h.post(`${x}/api/placement-test/topic/topics-assignedto-test`,{placement_test_id:d},r);console.log("Response test details : ",i.data),i.data.topics?w(i.data.topics):a.error("No topics found for this placement test.")}catch(t){t.response&&t.response.status===404?a.error("No topics added for this link"):(console.error("Error fetching topics:",t),a.error(t.message))}})(),s()},[d]);const T=s=>{N(s.target.value)},C=s=>{const l=s.target.files[0],t=["xlsx","xls"];if(l){const r=l.name.split(".").pop().toLowerCase();if(!t.includes(r)){a.error("Invalid file type. Please upload an .xlsx or .xls file."),b(null);return}b(l)}},U=async s=>{if(s.preventDefault(),!f){a.error("Please select a valid file to upload.");return}j(!0);try{const l=localStorage.getItem("token");if(!l)throw new Error("No token provided.");const t={headers:{Authorization:`Bearer ${l}`,"Content-Type":"multipart/form-data"}},r=new FormData;r.append("file",f);const i=await h.post(`${x}/api/placement-test/questions/upload-questions-link`,r,{params:{topic_id:c,placement_test_id:d},...t});a.success("Questions uploaded successfully!"),E(i.data)}catch(l){console.error("Error uploading questions:",l),a.error("Something went wrong while uploading the questions.")}finally{j(!1)}},Q=()=>g(!0),y=()=>g(!1),q=()=>{const s=document.createElement("a");s.href="/excelsheet_without_topic_id.xlsx",s.download="example_excel_sheet_without_topic_id.xlsx",document.body.appendChild(s),s.click(),document.body.removeChild(s),a.success("Example Excel sheet downloaded successfully!")};return e.jsxs("div",{className:"px-4 py-6",children:[p&&e.jsxs("div",{className:"my-6 flex justify-between items-center",children:[e.jsx("div",{className:"my-3 w-full md:w-1/2",children:e.jsxs("h5",{className:"text-lg font-semibold",children:["Test Link:",e.jsx("a",{href:p.test_link,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline",children:p.test_link})]})}),e.jsx(F,{to:`/admin/test/add-new-question/${p.placement_test_id}`,className:"w-full md:w-1/2",children:e.jsx("span",{className:"bg-transparent border-2 border-blue-500 text-blue-500 hover:bg-blue-500 hover:text-white px-4 py-2 rounded-md",children:"Add New Questions for this test link"})})]}),e.jsx("div",{className:"flex",children:e.jsx("div",{className:"w-full md:w-1/2",children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("h5",{className:"text-xl font-semibold",children:["Subject: ",m.length>0?m[0].subject_name:"N/A"]})}),e.jsx("p",{className:"text-lg leading-relaxed",children:"Upload questions by selecting a specific topic"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"topicSelect",className:"block text-sm font-medium ",children:"Select Topic"}),e.jsxs("select",{id:"topicSelect",value:c,onChange:T,className:"mt-1 block w-full p-3 border-2 text-black border-gray-300 rounded-md",required:!0,disabled:!k,children:[e.jsx("option",{value:"",children:"-- Select Topic --"}),m.map((s,l)=>e.jsx("option",{value:s.topic_id,children:s.topic_name},l))]})]}),e.jsx("button",{type:"button",className:"mt-3 bg-blue-300 text-black hover:bg-blue-500 hover:text-white px-4 py-2 rounded-md",onClick:Q,children:"Example Excel Sheet Format to Upload"}),e.jsx("button",{type:"button",className:"mt-3 bg-blue-500 text-white hover:bg-blue-700 px-4 py-2 rounded-md",onClick:q,children:"Download Example Excel Sheet"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"fileUpload",className:"block text-sm font-medium text-gray-700",children:"Upload Questions"}),e.jsx("input",{type:"file",onChange:C,className:"mt-1 block w-full p-3 border-2 border-gray-300 rounded-md",required:!0})]}),e.jsx("button",{type:"submit",className:`mt-3 w-full bg-green-500 text-white hover:bg-green-600 px-4 py-2 rounded-md ${!c||u?"opacity-50 cursor-not-allowed":""}`,disabled:!c||u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"})," Uploading..."]}):"Upload"})]})})}),n&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h5",{className:"text-xl font-semibold",children:"Upload Summary"}),e.jsxs("p",{children:["Total Questions: ",n.summary.totalQuestions]}),e.jsxs("p",{children:["Successfully Uploaded: ",n.summary.successfullyUploaded]}),e.jsxs("p",{children:["Successfully Assigned: ",n.summary.successfullyAssigned]}),e.jsxs("p",{children:["Skipped Questions: ",n.summary.skippedQuestionsCount]}),n.skippedQuestions.length>0&&e.jsx("div",{className:"overflow-x-auto bg-white shadow rounded-md mt-4",children:e.jsxs("table",{className:"min-w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left",children:[e.jsx("th",{className:"px-4 py-2",children:"Question"}),e.jsx("th",{className:"px-4 py-2",children:"Reason"})]})}),e.jsx("tbody",{children:n.skippedQuestions.map((s,l)=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"px-4 py-2",children:s.questionText}),e.jsx("td",{className:"px-4 py-2",children:s.reason})]},l))})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-50 flex justify-center items-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-xl w-11/12 md:w-1/2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Example Excel Sheet"}),e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-gray-700",children:"Ã—"})]}),e.jsx("img",{src:$,alt:"Example Excel Sheet",className:"w-full h-auto"}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{onClick:y,className:"bg-gray-500 text-white hover:bg-gray-600 px-4 py-2 rounded-md",children:"Close"})})]})})]})};export{P as default};
