import{r as a,u as ee,j as e,h as te,b as m,c as h,V as L}from"./index-CVcFn3UJ.js";const le=()=>{const[$,I]=a.useState([]),[f,Q]=a.useState([]),[q,M]=a.useState(""),[j,c]=a.useState([]),[N,B]=a.useState(20),[R,l]=a.useState(0),[w,S]=a.useState(""),[g,z]=a.useState(!1),[v,D]=a.useState(""),[k,V]=a.useState(""),[y,P]=a.useState(""),[b,U]=a.useState(!0),[p,X]=a.useState(!1),[x,F]=a.useState(!1),[T,se]=a.useState(""),[i,r]=a.useState({show:!1,message:"",variant:""}),[C,G]=a.useState(""),[ae,oe]=a.useState(""),[_,H]=a.useState(""),[ne,re]=a.useState(!1);ee(),a.useEffect(()=>{(async()=>{try{const s=localStorage.getItem("token");if(!s)throw new Error("No token provided.");const o={headers:{Authorization:`Bearer ${s}`}},n=await m.get(`${h}/api/placement-test/subject/get-all-subjects`,o);I(n.data.data)}catch(s){console.error("Error fetching subjects:",s)}})()},[]);const J=async t=>{const s=t.target.value;M(s),c([]),l(0),S("");try{const o=localStorage.getItem("token");if(!o)throw new Error("No token provided.");const n={headers:{Authorization:`Bearer ${o}`}},d=await m.get(`${h}/api/placement-test/topic/topics-by-subject/${s}`,n);console.log("topics , ",d.data);const u=d.data.topics;Q(u);const A=u.map(Z=>Z.topic_id)}catch(o){console.error("Erroro while fetching topics ",o),o.response&&o.response.status===404?r({show:!0,message:"No Topics Available for this Subject",variant:"info"}):(r({show:!0,message:"Something went wrong",variant:"danger"}),console.error("Error fetching topics:",o))}},K=t=>{c(s=>{const o=s.includes(t)?s.filter(n=>n!==t):[...s,t];return E(o),o})},O=()=>{if(z(!g),g)c([]),l(0);else{const t=f.map(s=>s.topic_id);c(t),E(t)}},E=async t=>{if(t.length===0){l(0);return}try{const s=localStorage.getItem("token");if(!s)throw new Error("No token provided.");const o={headers:{Authorization:`Bearer ${s}`}},d=(await m.post(`${h}/api/placement-test/questions/getQuestionCountsByTopicIds`,{topic_ids:t},o)).data.reduce((u,A)=>u+A.question_count,0);l(d)}catch(s){console.error("Error fetching available questions:",s)}},W=t=>{const s=t.target.value;B(s),s>R||S("")},Y=async()=>{try{const t=localStorage.getItem("token");if(!t)throw new Error("No token provided.");const s={headers:{Authorization:`Bearer ${t}`}},o=await m.post(`${h}/api/placement-test/test/test-link/create`,{number_of_questions:N,description:y,start_time:v,end_time:k,show_result:b,topic_ids:j,is_Monitored:p,test_title:C,certificate_name:_,issue_certificate:x},s);console.log(o.data,"---------------------------"),r({show:!0,message:"Link Created Successfully",variant:"success"}),L.success("Test Link Created"),window.scrollTo({top:0,behavior:"smooth"})}catch(t){console.error("Error creating test link:",t.response.data),r({show:!0,message:"Something went wrong!!",variant:"danger"}),L.error("Something went wrong",t.response.data),window.scrollTo({top:0,behavior:"smooth"})}};return e.jsxs("div",{className:"max-w-4xl mx-auto mt-5 p-4 bg-white shadow-md rounded-lg text-black",children:[i.show&&e.jsxs("div",{className:`p-4 mb-4 text-white rounded-md ${i.variant==="success"?"bg-green-500":"bg-red-500"}`,children:[i.message,e.jsx("button",{onClick:()=>r({...i,show:!1}),className:"float-right font-bold",children:"X"})]}),T&&e.jsxs("div",{className:"mt-4 p-3 border border-blue-500 rounded-md bg-gray-100",children:[e.jsx("h5",{className:"text-lg font-semibold",children:"Link Created Successfully:"}),e.jsx("p",{className:"text-blue-500 font-bold",children:T}),e.jsxs("p",{className:"font-semibold",children:["To add questions to this link,",e.jsx(te,{to:"/test-links",className:"text-blue-600 underline",children:" click here"}),"."]})]}),e.jsx("h3",{className:"text-center text-xl font-bold mb-4",children:"Create Test Link"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"Select Subject"}),e.jsxs("select",{className:"w-full p-2 border rounded-md bg-gray-100",value:q,onChange:J,required:!0,children:[e.jsx("option",{value:"",children:"-- Select Subject --"}),$.map(t=>e.jsx("option",{value:t.subject_id,children:t.name},t.subject_id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h5",{className:"font-medium text-gray-700",children:"Select Topics"}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:g,onChange:O}),"Select All Topics"]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:f.map(t=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:j.includes(t.topic_id),onChange:()=>K(t.topic_id)}),t.name]},t.topic_id))})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"Test Title"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded-md bg-gray-100",value:C,onChange:t=>G(t.target.value),placeholder:"Enter test title",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"Certificate Name"}),e.jsx("input",{type:"text",className:"w-full p-2 border rounded-md bg-gray-100",value:_,onChange:t=>H(t.target.value),placeholder:"Enter certificate name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"Number of Questions"}),e.jsx("input",{type:"number",className:"w-full p-2 border rounded-md bg-gray-100",value:N,onChange:W}),w&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:w})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 font-medium",children:"Test Description"}),e.jsx("textarea",{className:"w-full p-2 border rounded-md bg-gray-100",rows:3,value:y,onChange:t=>P(t.target.value)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"inline text-gray-700 font-medium me-2",children:"Start Time"}),e.jsx("input",{type:"datetime-local",className:" p-2 border rounded-md bg-gray-100",value:v,onChange:t=>D(t.target.value)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"inline text-gray-700 font-medium me-4",children:"End Time"}),e.jsx("input",{type:"datetime-local",className:" p-2 border rounded-md bg-gray-100",value:k,onChange:t=>V(t.target.value)})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:b,onChange:()=>U(!b)}),"Show Results After Test"]}),e.jsxs("label",{className:"flex items-center mt-2",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:p,onChange:()=>X(!p)}),"Enable Monitoring"]}),e.jsxs("label",{className:"flex items-center mt-2",children:[e.jsx("input",{type:"checkbox",className:"mr-2",checked:x,onChange:()=>F(!x)}),"Provide Certificate"]})]}),e.jsx("button",{className:"w-full bg-green-500 text-white p-3 rounded-md hover:bg-green-600 transition",onClick:Y,children:"Create Test Link"})]})};export{le as default};
